#!/bin/bash

set -e
source common
source wiki-config

TITLE="$1"

if [ -z "${TITLE:-}" -o -n "${2:-}" ]; then
  echo "$0: ERROR: Syntax: $0 <page_title>"
  exit 1
fi

## NOTE: Do not use 'echo' here as this script writes to stdout which is
##       processed by other scripts.
trap "" EXIT

true "$0: INFO: Fetching '${WIKI_INDEX}' '$TITLE'..."

# curl \
# --fail \
# --silent \
# --show-error \
# --location \
# --cookie "$cookie_jar" \
# --cookie-jar "$cookie_jar" \
# --user-agent "Curl Shell Script" \
# --keepalive-time 60 \
# --header "Accept-Language: en-GB" \
# --header "Connection: keep-alive" \
# --header "Expect:" \
# --data-urlencode "title=$TITLE" \
# --request "POST" "${WIKI_INDEX}?action=raw"

curl \
   --fail \
   --silent \
   --show-error \
   --location \
   --retry-connrefused \
   --retry 3 \
   --retry-delay 5 \
   --user-agent "Curl Shell Script" \
   --keepalive-time 60 \
   --header "Accept-Language: en-GB" \
   --header "Connection: keep-alive" \
   --header "Expect:" \
   "${WIKI_INDEX}?title=$TITLE&action=raw"

true "$0: INFO: Fetch success."
