#!/bin/bash

set -e
cd ..
source common

SOURCE_WIKI_INDEX='https://www.kicksecure.com/w/index.php'
SOURCE_WIKI_API='https://www.kicksecure.com/w/api.php'

DESTINATION_WIKI_API=(
   'https://www.whonix.org/w/api.php'
)
DESTINATION_WIKI_INDEX=(
   'https://www.whonix.org/w/index.php'
)

#COPY_WIKI_PAGES_LIST=(
#   "Testpage14"
#   "Testpage15"
#)

COPY_WIKI_PAGES_LIST=(
   "Testpage14"
)

WIKIAPI="$DESTINATION_WIKI_API" WIKIINDEX="$DESTINATION_WIKI_INDEX" \
   ./login

for copy_wiki_pages_item in ${COPY_WIKI_PAGES_LIST[@]} ; do
   echo "INFO: Fetching '$SOURCE_WIKI_INDEX' '$copy_wiki_pages_item'..."

   rm -f "$TMPFOLDER/fetched-wiki-page"

   WIKIAPI="$SOURCE_WIKI_API" WIKIINDEX="$SOURCE_WIKI_INDEX" \
      ./fetch \
         "$copy_wiki_pages_item" | \
         tee "$TMPFOLDER/fetched-wiki-page" >/dev/null

   test -f "$TMPFOLDER/fetched-wiki-page"
   cat "$TMPFOLDER/fetched-wiki-page"

   echo "INFO: Fetch success."

   wiki_page_content=$(cat "$TMPFOLDER/fetched-wiki-page")

   WIKIAPI="$DESTINATION_WIKI_API" \
   WIKIINDEX="$DESTINATION_WIKI_INDEX" \
   ./edit "$copy_wiki_pages_item" "$TMPFOLDER/fetched-wiki-page"
done
