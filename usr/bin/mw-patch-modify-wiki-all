#!/bin/bash

echo "$0: START"

#set -x
set -e

source /usr/share/mediawiki-shell/common

## example:
[[ -v DESTINATION_WIKI_URL ]] || DESTINATION_WIKI_URL='https://www.whonix.org/w'
SOURCE_WIKI_URL="$DESTINATION_WIKI_URL"

## These variables should be set by the calling script as environment variables.
[[ -v SOURCE_WIKI_URL ]] || missing_variable SOURCE_WIKI_URL For example: SOURCE_WIKI_URL='https://www.whonix.org/w'
[[ -v SOURCE_TARGET_API ]] || SOURCE_TARGET_API="${SOURCE_WIKI_URL}/api.php"

[[ -v mw_api_start_from ]] || mw_api_start_from=""

## XXX: required by /usr/share/mediawiki-shell/common but not elegant.
WIKI_URL="$SOURCE_WIKI_URL"

## TODO: abolish need for this and fetch all name spaces instead by default.
## Namespace 500 (Moved:) is not reviewable.
## Namespace 500 (Widget:) is not reviewable.
#export wiki_namespace_list_extra="500 274"

source /usr/share/mediawiki-shell/common
source /usr/share/mediawiki-shell/wiki-config

echo "$0: INFO: TMPFOLDER        : $TMPFOLDER"
echo "$0: INFO: SOURCE_WIKI_URL  : $SOURCE_WIKI_URL"
echo "$0: INFO: SOURCE_TARGET_API: $SOURCE_TARGET_API"

wiki_script=mw-patch-modify-wiki-page
export WIKI_URL SOURCE_WIKI_URL wiki_script

mw-process-all-pages
