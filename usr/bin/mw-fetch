#!/bin/bash

set -e
source /usr/share/mediawiki-shell/common
source /usr/share/mediawiki-shell/wiki-config

TITLE="$1"

if [ -z "${TITLE:-}" -o -n "${2:-}" ]; then
  echo "$0: ERROR: Syntax: $0 <page_title>"
  exit 1
fi

echo "$0: INFO: Fetching '${WIKI_INDEX}' '$TITLE'..."

rm -f "$wiki_fetch_to_file"
touch "$wiki_fetch_to_file"
test -w "$wiki_fetch_to_file"

# curl_run \
#    $curl_opts \
#    --cookie "$cookie_jar" \
#    --cookie-jar "$cookie_jar" \
#    --header "Accept-Language: en-GB" \
#    --header "Expect:" \
#    --data-urlencode "title=$TITLE" \
#    --request "POST" "${WIKI_INDEX}?action=raw"

curl_run \
   $curl_opts \
   --header "Accept-Language: en-GB" \
   --header "Expect:" \
   --output "$wiki_fetch_to_file" \
   "${WIKI_INDEX}?title=$TITLE&action=raw"

test -r "$wiki_fetch_to_file"

echo "$0: INFO: Fetch success."
